# Make file for ZapButtons
# using Acorn tools amu, objasm, link

# Targets:
#	Buttons		Assemble .s files and link. This is the default
#	Heders		Remake the automatically-created header files
#	Clean		Wipe the .o and .t (header marker) files

OBJECTS		= o.buttons
HEADERS		= h.buttons

TARGET		= Buttons
as		= objasm
asflags		= -o $@ -depend !Depend -throwback -stamp -quit
link		= link
linkPartFlags	= -aof
linkFlags	= -bin -B &00000000
ZapS		= <ZapSource$Dir>
ZapD		= <Zap$Dir>.Modules.!Buttons

Buttons:	$(OBJECTS) o Headers
		$(link) $(linkFlags) -o $(TARGET) $(OBJECTS)
		Settype $(TARGET) Module
		Run $(ZapS).data.MCopy $(TARGET) $(ZapD).$(TARGET)
		@Echo Finished $(TARGET)

Headers:	$(HEADERS)
		@Echo Made headers

o:;		cdir o

Clean:;		IfThere o.* Then Wipe o.* ~CF~R~V
		IfThere t.* Then Wipe t.* ~CF~R~V

# The .t file date gives the last time the header was created from the file.
# This is usually not the .h date as the .h file is not stamped if the file
# contents doesn't change.

.SUFFIXES: .t .s .o

.s.t:;		@Run $(ZapS).data.StoH s.$* h.$*
		Create t.$* 0

.s.o:;		$(as) $(asflags) s.$*

# Dynamic dependencies:
o.buttons: s.buttons
o.buttons: ZapSource:h.ZapHeader
o.buttons: ZapSource:h.System
o.buttons: ZapSource:h.ZapLibrary
o.buttons: ZapSource:h.ZapVars
o.buttons: ZapSource:h.Macros
o.buttons: ZapSource:h.ZapConsts
o.buttons: <ZapExtSource$Dir>.h.RegNames
o.buttons: <ZapExtSource$Dir>.h.Macros
o.buttons: h.buttons
